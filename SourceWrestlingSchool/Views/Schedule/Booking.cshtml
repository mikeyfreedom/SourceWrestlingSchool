@model SourceWrestlingSchool.Models.Lesson
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Booking";
    var userId = User.Identity.GetUserId();
    bool userFound = false;
    int id = Model.LessonID;   
}

<h2>Make a Booking/Cancellation</h2>

<div class="container">
    <h4>Lesson</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.ClassType)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ClassType)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ClassLevel)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ClassLevel)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ClassStartDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ClassStartDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ClassEndDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ClassEndDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ClassCost)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ClassCost)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.InstructorID)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.InstructorID)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Students)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Students.Count)
        </dd>

    </dl>
</div>
<div class="container">
    @if (Model.Students.Count == 0)
    {
        using (Html.BeginForm("BookUser", "Schedule", FormMethod.Post))
        {
            <input type="hidden" name="userID" value="@userId" />
            <input type="hidden" name="classID" value="@id" />
            <input class="btn btn-success" type="submit" value="Book Attendance">
        }
    }
    else
    {
        foreach (var student in Model.Students)
        {
            if (student.Id.Equals(userId))
            {
                userFound = true;
                break;
            }
        }

        if (!userFound)
        {
            using (Html.BeginForm("BookUser", "Schedule", FormMethod.Post))
            {
                <input type="hidden" name="userID" value="@userId" />
                <input type="hidden" name="classID" value="@id" />
                <input class="btn btn-success" type="submit" value="Book Attendance">
            }
        }
        else
        {
            using (Html.BeginForm("CancelUser", "Schedule", FormMethod.Post))
            {
                <input type="hidden" name="userID" value="@userId" />
                <input type="hidden" name="classID" value="@id" />
                <input class="btn btn-danger" type="submit" value="Cancel Attendance">
            }
        }
    }       
</div>
<p>
    @Html.ActionLink("Back to Schedule", "Index")
</p>
